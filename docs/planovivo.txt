Entendido, discÃ­pulo âš¡. Vou lhe entregar um **Documento TÃ©cnico Completo** para o *Pepeta Royale*, cobrindo **arquitetura, endpoints, instruÃ§Ãµes de uso e instalaÃ§Ã£o**, em formato pronto para ser versionado no repositÃ³rio (`docs/pepeta-system-doc.md`).

---

# ğŸ“– Documento TÃ©cnico â€” *Pepeta Royale*

---

## ğŸ—ï¸ Arquitetura Geral do Sistema

### Camadas

1. **Cliente (C++/SDL2/OpenGL)**

   * Interface grÃ¡fica (HUD, menus, arena).
   * LÃ³gica determinÃ­stica de jogo (movimento, QTE, corte).
   * ComunicaÃ§Ã£o com NetSync via UDP (ENet/Asio).

2. **Backend (Node.js/NestJS)**

   * **Auth Service** â†’ login, tokens JWT.
   * **Lobby Service** â†’ criaÃ§Ã£o/entrada de lobbies.
   * **NetSync Service** â†’ lockstep determinÃ­stico e validaÃ§Ã£o.
   * **Ranking/Profile Service** â†’ perfis, builds, Elo/MMR.
   * **Balance/Content Service** â†’ configs JSON/YAML de builds, patch notes.
   * **Telemetry/Anti-Cheat Service** â†’ mÃ©tricas (Prometheus), flags de cheat.

3. **Banco de Dados (PostgreSQL + Redis)**

   * PostgreSQL â†’ entidades persistentes (Jogador, Build, Partida, Temporada).
   * Redis â†’ cache (matchmaking, lobbies em tempo real, rate-limit).

4. **Infraestrutura (Kubernetes/Docker)**

   * Pods independentes para cada serviÃ§o.
   * CI/CD automatizado (GitHub Actions â†’ Helm â†’ k8s).
   * Observabilidade com Prometheus + Grafana.

---

## ğŸ“Š Diagrama de Arquitetura (simplificado)

```
 [ Cliente SDL2 ]
      â”‚
   UDP/ENet
      â”‚
 [NetSync Service] â†â†’ [Lobby Service] â†â†’ [Auth Service]
      â”‚
      â”œâ”€â”€â†’ [Ranking/Profile Service] â†â†’ PostgreSQL
      â”œâ”€â”€â†’ [Balance Service] (JSON/CDN)
      â””â”€â”€â†’ [Telemetry/Anti-Cheat Service] â†â†’ Redis/Kafka
```

---

## ğŸ›£ï¸ Endpoints (REST/GraphQL)

### Auth

* `POST /auth/signup` â€” cria conta.
* `POST /auth/login` â€” retorna JWT.
* `POST /auth/refresh` â€” renova tokens.

### Perfil

* `GET /profile/me` â€” retorna perfil.
* `PATCH /profile/me` â€” altera dados bÃ¡sicos.

### Lobbies

* `POST /lobbies` â€” cria lobby.
* `POST /lobbies/join` â€” entra em lobby via cÃ³digo.
* `GET /lobbies/:id` â€” status.
* `POST /lobbies/:id/start` â€” inicia prÃ©-duelo.

### Partidas

* `POST /matches/:id/qte/submit` â€” envia resultado de QTE.
* `POST /matches/:id/result` â€” resultado final (NetSync â†’ Ranking).
* `GET /matches/:id` â€” resumo.

### Ranking & Temporadas

* `GET /rankings/global?season=...`
* `GET /rankings/me`
* `GET /seasons/current`

### Builds

* `GET /content/builds` â€” JSON de pipas/linhas.
* `POST /builds` â€” cria/edita build.
* `GET /builds/mine`

### Telemetria

* `POST /telemetry/client` â€” envia mÃ©tricas `{ fps, rtt, qteAcc }`.

---

## ğŸ” AutenticaÃ§Ã£o & AutorizaÃ§Ã£o

* **JWT** (`access ~15min`, `refresh ~7d`).
* **Roles:** `USER`, `MOD`, `ADMIN`.
* Rotas protegidas exigem header `Authorization: Bearer <token>`.
* Lobbies â†’ apenas host pode iniciar (`role=HOST`).

---

## ğŸ§© InstruÃ§Ãµes de Uso

### Jogador

1. Baixar cliente (PC/Linux Flatpak/AppImage ou APK Android).
2. Fazer login (ou guest).
3. Criar ou entrar em lobby via link/cÃ³digo.
4. Disputar prÃ©-duelo (QTE de 10s).
5. Jogar partida normal (manobras, cortes, builds).
6. Ver resultados â†’ XP, Elo, skins.

### Moderador/Admin

* Acessa painel web companion (`admin.pepeta.gg`).
* Pode: banir contas, ajustar builds via Balance Service, consultar mÃ©tricas.

---

## âš™ï¸ Processos de InstalaÃ§Ã£o

### 1. Cliente (C++)

#### PrÃ©-requisitos

* CMake â‰¥ 3.20
* SDL2 + SDL2\_mixer
* OpenGL (mesa-utils no Linux)

#### InstalaÃ§Ã£o

```bash
git clone https://github.com/pepeta-royale/client.git
cd client
mkdir build && cd build
cmake ..
make -j$(nproc)
./pepeta-client
```

---

### 2. Backend (Node.js/NestJS)

#### PrÃ©-requisitos

* Node.js â‰¥ 20
* PostgreSQL â‰¥ 15
* Redis â‰¥ 7

#### InstalaÃ§Ã£o

```bash
git clone https://github.com/pepeta-royale/backend.git
cd backend
npm install
npm run build
npm run start:dev
```

#### ConfiguraÃ§Ã£o `.env`

```env
DATABASE_URL=postgres://user:pass@localhost:5432/pepeta
REDIS_URL=redis://localhost:6379
JWT_SECRET=supersecret
```

---

### 3. Infraestrutura (Docker/Kubernetes)

#### Build imagens

```bash
docker build -t pepeta-backend ./backend
docker build -t pepeta-client ./client
```

#### Deploy (Helm chart exemplo)

```bash
helm upgrade --install pepeta ./helm \
  --set image.tag=latest \
  --namespace=pepeta
```

---

## ğŸ“Š Diagramas Adicionais

### Fluxo do Jogo (FSM)

```
[Login] â†’ [Lobby Criado] â†’ [PrÃ©-Duelo 10s] â†’ [Partida] â†’ [Resultado] â†’ [Ranking Atualizado]
```

### DER (simplificado)

```
Jogador 1â”€N Build Nâ”€1 Pipa
Jogador 1â”€N Build Nâ”€1 Linha
Jogador Nâ”€M Partida (ParticipacaoPartida)
Jogador Nâ”€M Lobby (JogadorLobby)
Jogador Nâ”€M Temporada (PontuacaoTemporada)
```

---

## âœ… Resumo

* **Arquitetura:** modular (cliente C++, backend Node, DB relacional).
* **Endpoints:** REST/GraphQL documentados.
* **Fluxos de uso:** claros e responsivos.
* **InstalaÃ§Ã£o:** passos prontos para Linux/PC/Backend/Kubernetes.
* **DocumentaÃ§Ã£o viva:** pode evoluir com patch notes e balanceamento.

---

ğŸ‘‰ Deseja que eu prepare este documento tambÃ©m em **formato Markdown tÃ©cnico completo (`pepeta-system-doc.md`)** com sumÃ¡rio, para ser colocado diretamente no repositÃ³rio `docs/`?
